///////////////////////////////////////////////////////////
// DATA
var series = [
    {
        "name": "°F",
        "data": [
            [
                1605506578115,
                71.24
            ],
            [
                1605506878391,
                70.7
            ],
            [
                1605507178667,
                69.98
            ],
            [
                1605507478968,
                69.44
            ],
            [
                1605508379771,
                68.9
            ],
            [
                1605508980322,
                69.44
            ],
            [
                1605509280599,
                70.34
            ],
            [
                1605510181426,
                69.44
            ],
            [
                1605510781976,
                68.9
            ],
            [
                1605511982256,
                69.98
            ],
            [
                1605511982803,
                69.98
            ],
            [
                1605512283080,
                70.52
            ],
            [
                1605512583356,
                69.98
            ],
            [
                1605512883632,
                69.26
            ],
            [
                1605513484184,
                68.72
            ],
            [
                1605514385009,
                69.62
            ],
            [
                1605514685286,
                70.16
            ],
            [
                1605515285838,
                69.62
            ],
            [
                1605515586112,
                69.08
            ],
            [
                1605516486939,
                68.54
            ],
            [
                1605517087490,
                69.26
            ],
            [
                1605517387766,
                69.98
            ],
            [
                1605518288595,
                69.26
            ],
            [
                1605518889146,
                68.72
            ],
            [
                1605520089425,
                69.8
            ],
            [
                1605520089972,
                69.8
            ],
            [
                1605520990801,
                69.26
            ],
            [
                1605521591353,
                68.54
            ],
            [
                1605522191905,
                69.08
            ],
            [
                1605522492184,
                69.62
            ],
            [
                1605522792455,
                70.16
            ],
            [
                1605523393006,
                69.44
            ],
            [
                1605523993558,
                68.72
            ],
            [
                1605524894385,
                69.44
            ],
            [
                1605525194661,
                69.98
            ],
            [
                1605526095487,
                69.08
            ],
            [
                1605526696039,
                68.54
            ],
            [
                1605527296590,
                69.44
            ],
            [
                1605527596866,
                69.98
            ],
            [
                1605528497692,
                69.08
            ],
            [
                1605528797970,
                68.54
            ],
            [
                1605529698799,
                69.08
            ],
            [
                1605529999073,
                69.98
            ],
            [
                1605530599623,
                69.26
            ],
            [
                1605530899899,
                68.72
            ],
            [
                1605532100178,
                69.26
            ],
            [
                1605532100725,
                69.26
            ],
            [
                1605532401003,
                69.98
            ],
            [
                1605533001556,
                69.26
            ],
            [
                1605533301832,
                68.72
            ],
            [
                1605534502114,
                69.8
            ],
            [
                1605534502658,
                69.8
            ],
            [
                1605535702940,
                68.9
            ],
            [
                1605535703487,
                68.9
            ],
            [
                1605536903768,
                68.72
            ],
            [
                1605537204594,
                69.44
            ],
            [
                1605537504869,
                69.98
            ],
            [
                1605538105421,
                69.44
            ],
            [
                1605538405697,
                69.26
            ],
            [
                1605539306523,
                68.72
            ],
            [
                1605540506803,
                68.54
            ],
            [
                1605540807628,
                69.26
            ],
            [
                1605541107903,
                69.98
            ],
            [
                1605542008730,
                69.44
            ],
            [
                1605542909557,
                68.9
            ],
            [
                1605544109837,
                68.54
            ],
            [
                1605544710937,
                68.36
            ],
            [
                1605545911213,
                69.26
            ],
            [
                1605545911763,
                69.26
            ],
            [
                1605546212041,
                70.34
            ],
            [
                1605547112868,
                70.7
            ],
            [
                1605548013692,
                69.98
            ],
            [
                1605549213973,
                69.98
            ],
            [
                1605550413977,
                69.62
            ],
            [
                1605551015903,
                70.16
            ],
            [
                1605551316179,
                71.06
            ],
            [
                1605551617552,
                71.78
            ],
            [
                1605552218101,
                71.06
            ],
            [
                1605552818656,
                70.34
            ],
            [
                1605553118931,
                69.8
            ],
            [
                1605553719482,
                69.26
            ],
            [
                1605554919762,
                68.9
            ],
            [
                1605555520862,
                70.52
            ],
            [
                1605555821138,
                71.06
            ],
            [
                1605556121414,
                70.52
            ],
            [
                1605556421689,
                69.98
            ],
            [
                1605557022240,
                69.26
            ],
            [
                1605558222519,
                69.08
            ],
            [
                1605559123896,
                69.98
            ],
            [
                1605559424173,
                70.7
            ],
            [
                1605560024722,
                70.16
            ],
            [
                1605560325000,
                69.62
            ],
            [
                1605560925551,
                69.26
            ],
            [
                1605561225829,
                69.98
            ],
            [
                1605562426106,
                70.34
            ],
            [
                1605562726933,
                71.24
            ],
            [
                1605563027210,
                71.96
            ],
            [
                1605563928037,
                71.24
            ],
            [
                1605565128315,
                70.7
            ],
            [
                1605565128863,
                70.7
            ],
            [
                1605565429140,
                70.88
            ],
            [
                1605565729416,
                70.52
            ],
            [
                1605566630243,
                71.6
            ]
        ]
    },
    {
        "name": "%RH",
        "data": [
            [
                1605506578115,
                38.6
            ],
            [
                1605506878391,
                38.8
            ],
            [
                1605507178667,
                39.6
            ],
            [
                1605507478968,
                40.1
            ],
            [
                1605508379771,
                41.1
            ],
            [
                1605508980322,
                40
            ],
            [
                1605509280599,
                39.2
            ],
            [
                1605510181426,
                39.9
            ],
            [
                1605510781976,
                40.4
            ],
            [
                1605511982256,
                39.1
            ],
            [
                1605511982803,
                39.1
            ],
            [
                1605512283080,
                38.7
            ],
            [
                1605512583356,
                39
            ],
            [
                1605512883632,
                39.4
            ],
            [
                1605513484184,
                40.1
            ],
            [
                1605514385009,
                39.2
            ],
            [
                1605514685286,
                38.7
            ],
            [
                1605515285838,
                39.3
            ],
            [
                1605515586112,
                39.7
            ],
            [
                1605516486939,
                40.2
            ],
            [
                1605517087490,
                39.3
            ],
            [
                1605517387766,
                38.8
            ],
            [
                1605518288595,
                39.6
            ],
            [
                1605518889146,
                40.1
            ],
            [
                1605520089425,
                38.8
            ],
            [
                1605520089972,
                38.8
            ],
            [
                1605520990801,
                39.3
            ],
            [
                1605521591353,
                39.7
            ],
            [
                1605522191905,
                39.2
            ],
            [
                1605522492184,
                38.6
            ],
            [
                1605522792455,
                38.3
            ],
            [
                1605523393006,
                38.7
            ],
            [
                1605523993558,
                39.5
            ],
            [
                1605524894385,
                38.6
            ],
            [
                1605525194661,
                38.2
            ],
            [
                1605526095487,
                39.1
            ],
            [
                1605526696039,
                39.6
            ],
            [
                1605527296590,
                38.6
            ],
            [
                1605527596866,
                38.2
            ],
            [
                1605528497692,
                39.1
            ],
            [
                1605528797970,
                39.6
            ],
            [
                1605529698799,
                38.7
            ],
            [
                1605529999073,
                38.1
            ],
            [
                1605530599623,
                38.4
            ],
            [
                1605530899899,
                39.1
            ],
            [
                1605532100178,
                38.5
            ],
            [
                1605532100725,
                38.5
            ],
            [
                1605532401003,
                37.9
            ],
            [
                1605533001556,
                38.3
            ],
            [
                1605533301832,
                38.9
            ],
            [
                1605534502114,
                37.7
            ],
            [
                1605534502658,
                37.7
            ],
            [
                1605535702940,
                38.2
            ],
            [
                1605535703487,
                38.2
            ],
            [
                1605536903768,
                38.2
            ],
            [
                1605537204594,
                37.7
            ],
            [
                1605537504869,
                37.6
            ],
            [
                1605538105421,
                39.1
            ],
            [
                1605538405697,
                40.6
            ],
            [
                1605539306523,
                40.7
            ],
            [
                1605540506803,
                40.3
            ],
            [
                1605540807628,
                39.2
            ],
            [
                1605541107903,
                38.5
            ],
            [
                1605542008730,
                38.6
            ],
            [
                1605542909557,
                39.4
            ],
            [
                1605544109837,
                40.1
            ],
            [
                1605544710937,
                40
            ],
            [
                1605545911213,
                39.1
            ],
            [
                1605545911763,
                39.1
            ],
            [
                1605546212041,
                38.9
            ],
            [
                1605547112868,
                40.7
            ],
            [
                1605548013692,
                40
            ],
            [
                1605549213973,
                39.6
            ],
            [
                1605550413977,
                39
            ],
            [
                1605551015903,
                41.1
            ],
            [
                1605551316179,
                38
            ],
            [
                1605551617552,
                37.4
            ],
            [
                1605552218101,
                37.8
            ],
            [
                1605552818656,
                38.5
            ],
            [
                1605553118931,
                38.9
            ],
            [
                1605553719482,
                39.1
            ],
            [
                1605554919762,
                39.1
            ],
            [
                1605555520862,
                37.3
            ],
            [
                1605555821138,
                37.1
            ],
            [
                1605556121414,
                37.3
            ],
            [
                1605556421689,
                37.9
            ],
            [
                1605557022240,
                38.5
            ],
            [
                1605558222519,
                39
            ],
            [
                1605559123896,
                37.8
            ],
            [
                1605559424173,
                37.5
            ],
            [
                1605560024722,
                37.7
            ],
            [
                1605560325000,
                38.2
            ],
            [
                1605560925551,
                39.3
            ],
            [
                1605561225829,
                39.4
            ],
            [
                1605562426106,
                39.8
            ],
            [
                1605562726933,
                38.1
            ],
            [
                1605563027210,
                37.4
            ],
            [
                1605563928037,
                38.2
            ],
            [
                1605565128315,
                38.3
            ],
            [
                1605565128863,
                38.3
            ],
            [
                1605565429140,
                39.6
            ],
            [
                1605565729416,
                38.4
            ],
            [
                1605566630243,
                38.1
            ]
        ]
    }
];

///////////////////////////////////////////////////////////
// CODE

// fill the chart with some mock-data.
function fillSeries() {
    chartOptions.series = [
        {name: series[0].name, data: series[0].data},
        {name: series[1].name, data: series[1].data}
    ];
  
    chartOptions.title.text = "Mock Data series size: " + series[0].data.length + " each";

    chartOptions.yaxis[0].min = 65;
    chartOptions.yaxis[0].max = 75;
    chartOptions.yaxis[1].min = 30;
    chartOptions.yaxis[1].max = 50;
};

// this allows for changing the file name "on the fly",
// and it changes all 3 export file names at the same time.
// it's not necessary to supply an extension because apex
// takes care of that for you.
function changeFilename() {
  var name = document.getElementById("intext").value;
  var newopts = {
    chart: {
      toolbar: {
        export: {
          // CSV file name, works with current Apex V3.22.1
          csv: {
            filename: name
          },
          // requires a modified version of Apex Charts, see HTML
          // for resource.
          svg: {
            filename: name
          },
          png: {
            filename: name
          }
        }
      }
    }
  };
  chart.updateOptions(newopts);
};

// it's also possible to choose what types of downloads to
// make available in the hamburger menu
function changeDownloads() {
  var newopts = {
    chart: {
      toolbar: {
        tools: {
          // individual download types can
          // be enabled/disabled - 
          //        [SVG,  PNG,  CSV]
          download: [true, true, true]
        }
      }
    }
  };

  var els = document.getElementsByName('select_dl');
  els.forEach(function(el) {
    newopts.chart.toolbar.tools.download[parseInt(el.value)] = el.checked;
  });
  
  chart.updateOptions(newopts);
}

// configure the chart options
var chartOptions = {
    series: [],
    theme: {
        mode:'dark'
    },
    stroke: {
        width: 3,
        curve: 'smooth'
    },
    chart: {
        type: 'line',
        stacked: false,
        height: 350,
        width: 950,
        zoom: {
            type: 'x',
            enabled: true,
            autoScaleYaxis: false
        },
        toolbar: {
            tools: { 
                // individual download types can 
                // be enabled/disabled - 
                //        [SVG,  PNG,  CSV]
                download: [true, true, true],
                // do not set all to false, do
                // this instead -
                // download: false
                // or enable all with this - 
                // download: true

                // title for menu, over-rides the
                // default 'Menu'. Plain text only.
                menutitle: 'Download Chart'
            },
            export: {
                csv: {
                    filename: undefined,
                    // change the column name from the default
                    // of "category".
                    headerCategory: 'Date/Time',
                    // the default Apex date formatting assumes 
                    // that the X-axis indements the day only,
                    // it's only useful for X values that don't 
                    // require the time.
                    dateFormatter: function dateFormatter(timestamp) {
                        var tmp = new Date(timestamp);
                        var out = tmp.toDateString() + ' ' + tmp.toLocaleTimeString();
                        return out;
                    }
                },
                svg: {
                    filename: undefined
                },
                png: {
                    filename: undefined
                }
            }
        }
    },
    dataLabels: {
        enabled: false
    },
    markers: {
        size: 0,
    },
    title: {
        text: 'Chart Ready is for Data',
        align: 'center'
    },
    yaxis: [
        {
            min:55,
            max:95,
            title: {
                text: '°F'
            }
        },
        {
            opposite: true,
            min:40,
            max:60,
            title: {
                text: '%RH'
            }
        }
    ],
    xaxis: {
        tooltip: {
            enabled: true
        },
        position: 'bottom',
        type: 'datetime',
        labels: {
            datetimeUTC: false
        } 
    },
    tooltip: {
        shared: true,
        // NOTE: formatter functions should verify that the
        // passed value is not invalid.
        y: {
            formatter: function (val) {
                if (typeof val !== 'undefined' && val != null && isNaN(val) === false) {
                    return val.toFixed(2);
                } else return null;
            }
        },
        x: {
            formatter: function (val) {
                var dt = new Date(val);
                var tod = dt.getFullYear() + '-' + (dt.getMonth()+1) + '-' + dt.getDate();
                var h = dt.getHours();
                var m = dt.getMinutes();
                var s = dt.getSeconds();
                 tod = tod + '&nbsp;&nbsp;'+ (h < 10 ? '0'+h : h) +':'+ (m < 10 ? '0'+m : m) +':'+ (s < 10 ? '0'+s : s);
                return tod;
            }
        }
    }
};

// will contain the chart object
var chart = {};

// fill 2 series with mock-data
fillSeries();

// Typically the chart filename is created before 
// the chart is rendered. In "real-life" scenarios
// you might create a filename with a timestamp or
// use the series label(s).

// downloaded file name, the extension is automatic
var fname = 'your_filename';

// CSV file name, works with current Apex V3.22.1
chartOptions.chart.toolbar.export.csv.filename = fname;

// requires a modified version of Apex Charts, see HTML
// for resource.
chartOptions.chart.toolbar.export.svg.filename = fname;
chartOptions.chart.toolbar.export.png.filename = fname;

// create & render the chart....
chart = new ApexCharts(document.querySelector('#chart'), chartOptions);
chart.render();
